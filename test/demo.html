<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Jasmine Spec Runner</title>
    <script type="text/javascript" src="lib/jquery-1.7.1.js"></script>
    <script type="text/javascript" src="http://localhost:5555/all.js"></script>
</head>
<body>
  
  <div id="users">
    
    <ul class="list">
      <script type="text/html" data-template="user">
        <li>
          <h4 data-text="user.name"></h4>
        </li>
      </script>
    </ul>
    
  </div>
  
  <script type="text/javascript" charset="utf-8">
    var Repo = Bootic.Repository.extend({
      run: function () {
        var self = this;
        setTimeout(function () {
          self.add({name: "Struct " + new Date().getTime()})
          self.run()
        }, 3000)
      },
      
      _add: function (item, promise) {
        var self = this
        setTimeout(function () {
          promise.resolve(item)
        }, 4000)
      }
    })
    
    Bootic.Logger.logging = true

    logger = new Bootic.Logger('test')
  
    o = new Bootic.Struct({name: 'ismael'})
    foo = function (name){console.log(name, 'changed')}
    o.on('change', foo)
    o.trigger('change', 'foo', 'bar')
    o.off('change', foo)
    
    o.trigger('change', 'fooedededefr', 'bar')
    
    o.on('change:name', foo)
    o.set('name', 'another name')
    
    o.set({name: 'yet another', foo: 'bar'})
    
    
    index = new Bootic.Index(Bootic.Struct, {logger: logger})
    
    repo = new Repo(index)
    
    p1 = new Bootic.Pipe({logger: logger})
    
    var DelayedPipe = Bootic.Pipe.extend({
      _add: function (item, promise) {
        this.logger.info('delayed pipe _add ' + item)
        setTimeout(function (){promise.resolve()}, 1000)
      }
    })
    
    p2 = new DelayedPipe({logger: logger})
    
    index.pipe(p1).pipe(p2)
    
    function log(label) {
      return function (item) {
        console.warn(label, item)
      }
    }
    
    p1.on('add', log('p1 add')).on('remove', log('p1 remove'))
    p2.on('add', log('p2 add')).on('remove', log('p2 remove'))
    
    $(function () {
      
      
    })
  </script>
</body>
</html>